<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Discord Activity Wrapper</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: black;
      overflow: hidden;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
  </style>
  <script type="module" crossorigin src="/assets/index-CwdysuZZ.js"></script>
</head>
<body>

  <!-- Tu script principal (Discord SDK, OAuth, etc.) -->

  <!-- Aqui vive Godot -->
  <iframe id="game-frame" src="./game/index.html"></iframe>

<script>
/* ===========================================================
   1) Funcion que main.js llamara para enviar auth
   =========================================================== */
window.sendAuthToGodot = function (payload) {
    console.log("Wrapper recibio auth de main.js:", payload);

    const frame = document.getElementById("game-frame");

    if (!frame || !frame.contentWindow) {
        console.error("Iframe no listo");
        return;
    }

    // Enviamos la data hacia el iframe donde vive Godot
    frame.contentWindow.postMessage(payload, "*");

    console.log("Enviado por postMessage al iframe");
};


/* ===========================================================
   2) Logging de mensajes que regresen desde el iframe (debug)
   =========================================================== */
window.addEventListener("message", (event) => {
    if (!event.data) return;

    if (event.data.type === "discord-auth") {
        console.log("Wrapper: mensaje desde iframe:", event.data);
    }
});
</script>

</body>
</html>
